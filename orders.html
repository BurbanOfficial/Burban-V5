<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes commandes - BRAND</title>
    <link rel="stylesheet" href="https://burbanofficial.github.io/Burban-V5/css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <a href="/">BRAND</a>
            </div>
            <div class="header-actions">
                <a href="/" class="icon-btn" aria-label="Accueil" title="Accueil">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </a>
            </div>
        </div>
    </header>

    <main style="max-width: 1000px; margin: 0 auto; padding: var(--spacing-xl) var(--spacing-lg);">
        <h1 style="margin-bottom: var(--spacing-lg);">Mes commandes</h1>
        
        <div id="ordersList"></div>
    </main>

    <footer class="footer">
        <div class="footer-bottom">
            <p>&copy; 2024 BRAND. Tous droits réservés.</p>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
    <script src="https://burbanofficial.github.io/Burban-V5/js/config.js"></script>
    <script src="https://burbanofficial.github.io/Burban-V5/js/firebase-init.js"></script>
    <script src="https://burbanofficial.github.io/Burban-V5/js/utils.js"></script>
    <script>
        async function loadOrders() {
            const user = auth.currentUser;
            const container = document.getElementById('ordersList');

            if (!user) {
                container.innerHTML = `
                    <p style="color: var(--color-text-light); margin-bottom: var(--spacing-lg);">Veuillez vous connecter pour voir vos commandes.</p>
                    <a href="/" class="btn-checkout" style="display: inline-block; padding: var(--spacing-sm) var(--spacing-lg); background: var(--color-accent); color: var(--color-bg); text-decoration: none; border-radius: var(--radius-md);">Retour</a>
                `;
                return;
            }

            try {
                const snapshot = await db.collection('orders')
                    .where('userId', '==', user.uid)
                    .orderBy('createdAt', 'desc')
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = `
                        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-lg);">Aucune commande pour le moment.</p>
                        <a href="/" class="btn-checkout" style="display: inline-block; padding: var(--spacing-sm) var(--spacing-lg); background: var(--color-accent); color: var(--color-bg); text-decoration: none; border-radius: var(--radius-md);">Continuer les achats</a>
                    `;
                    return;
                }

                const html = snapshot.docs.map(doc => {
                    const order = doc.data();
                    const date = new Date(order.createdAt.toDate()).toLocaleDateString('fr-FR');
                    
                    return `
                        <div style="border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                                <div>
                                    <p style="color: var(--color-text-light); font-size: 0.9rem;">Numéro de commande</p>
                                    <p style="font-weight: 600;">${order.stripeSessionId.substring(0, 20)}...</p>
                                </div>
                                <div>
                                    <p style="color: var(--color-text-light); font-size: 0.9rem;">Date</p>
                                    <p style="font-weight: 600;">${date}</p>
                                </div>
                                <div>
                                    <p style="color: var(--color-text-light); font-size: 0.9rem;">Montant</p>
                                    <p style="font-weight: 600;">${formatPrice(order.amount)}</p>
                                </div>
                            </div>
                            <div>
                                <p style="color: var(--color-text-light); font-size: 0.9rem;">Statut</p>
                                <p style="font-weight: 600; color: var(--color-accent);">${order.status === 'completed' ? 'Confirmée' : 'En attente'}</p>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading orders:', error);
                container.innerHTML = '<p style="color: red;">Erreur lors du chargement des commandes.</p>';
            }
        }

        // Wait for auth to be ready
        auth.onAuthStateChanged(() => {
            loadOrders();
        });
    </script>
</body>
</html>
